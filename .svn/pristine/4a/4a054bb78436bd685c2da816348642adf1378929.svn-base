package fr.eseo.ld.proseboard.selenium;
import static org.testng.AssertJUnit.assertEquals;

import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.htmlunit.HtmlUnitDriver;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;



public class ProseBoardTestConsultant {
	private WebDriver webDriver;
	
	/*
	 * Initialise html driver + connexion en tant qu'auditeur.
	 */
	@BeforeClass
	public void initiateWebDriver(){
		webDriver = new HtmlUnitDriver();
		webDriver.get("http://localhost:8080/proseboard/login");
		WebElement mailBox = webDriver.findElement(By.name("login"));
		WebElement passwordBox = webDriver.findElement(By.name("password"));
		mailBox.sendKeys("martin.dupont@proseboard.fr");
		passwordBox.sendKeys("1234");
		WebElement loginButton = webDriver.findElement(By.name("submit"));
		loginButton.click();
	}
	/*
	 * Test si la connexion s'est bien passée
	 */
	@Test
	public void testTitlePage(){
		assertEquals(webDriver.getTitle(),"ProSEBoard");
	}
/*
 * Test si liens vers les actions du consultant existent
 */
	
	@Test(dependsOnMethods={"testTitlePage"})
	public void testActionConsultant(){
		List<WebElement> webElements = webDriver.findElements(By.tagName("li"));
		assertEquals(webElements.get(4).getText(),"Facturer une session de consulting");
		assertEquals(webElements.get(5).getText(),"Créer un rapport de consultation");
		assertEquals(webElements.get(6).getText(),"Voir les rapports de consultation");
	}

/*
 * Test si le lien pour facturer une équipe fonctionne et que les différents éléments sont présent.
 */
	
	@Test(dependsOnMethods={"testActionConsultant"})
	public void testFacturerSessionConsultingLink(){
		WebElement facturerSessionLink = webDriver.findElement(By.linkText("Facturer une session de consulting"));
		facturerSessionLink.click();
		WebElement firstString = webDriver.findElement(By.tagName("h1"));
		List<WebElement> tableauElement = webDriver.findElements(By.tagName("th"));
		assertEquals(firstString.getText(),"Sessions facturables");
		assertEquals(tableauElement.get(0).getText(),"N°");
		assertEquals(tableauElement.get(1).getText(),"Date");
		assertEquals(tableauElement.get(2).getText(),"Nombre d'heures");
		assertEquals(tableauElement.get(3).getText(),"Montant");
	}
/*
 * Test retour en arriere
 */
	@Test(dependsOnMethods={"testFacturerSessionConsultingLink"})
	public void testRetourArriereLink(){
		List<WebElement> links = webDriver.findElements(By.tagName("button"));
		links.get(links.size()-1).click();
		assertEquals(webDriver.getCurrentUrl(),"http://localhost:8080/proseboard/");
	}
/*
 * Test lien créer un rapport de consultation 
 */
	@Test(dependsOnMethods={"testRetourArriereLink"})
	public void testCreerRapportLien(){
		WebElement link = webDriver.findElement(By.linkText("Créer un rapport de consultation"));
		link.click();
		assertEquals(webDriver.getCurrentUrl(),"http://localhost:8080/proseboard/consultation/creer");
	}
/*
 * Test contenu de la page créer un rapport de consultation 
 */
	@Test(dependsOnMethods={"testCreerRapportLien"})
	public void testContenuCreerRapportConsultation(){
		WebElement firstString = webDriver.findElement(By.tagName("h1"));
		WebElement secondString = webDriver.findElement(By.tagName("h2"));
		List<WebElement> inputFields = webDriver.findElements(By.tagName("input"));
		List<WebElement> selectFields = webDriver.findElements(By.tagName("select"));
		WebElement textareaField = webDriver.findElement(By.tagName("textarea"));
		assertEquals(firstString.getText(),"Rapport de consultation");
		assertEquals(secondString.getText(),"Insérer les informations suivantes");
		assertEquals(inputFields.get(0).getAttribute("name"),"id_team");
		assertEquals(inputFields.get(1).getAttribute("name"),"hours");
		assertEquals(selectFields.get(0).getAttribute("name"),"day");
		assertEquals(selectFields.get(1).getAttribute("name"),"month");
		assertEquals(selectFields.get(2).getAttribute("name"),"year");
		assertEquals(textareaField.getAttribute("name"),"report");
	}
	
/*
 * Test du lien pour voir les rapports de consultation
 */
	@Test(dependsOnMethods={"testContenuCreerRapportConsultation"})
	public void testVoirRapportLink(){
		WebElement link = webDriver.findElement(By.linkText("Voir les rapports de consultation"));
		link.click();
		assertEquals(webDriver.getCurrentUrl(),"http://localhost:8080/proseboard/consultation/manager");
	}
/*
 * Test du contenu de la page pour voir les rapports 
 */
	@Test(dependsOnMethods={"testVoirRapportLink"})
	public void testContenuVoirRapport(){
		WebElement firstString = webDriver.findElement(By.tagName("h1"));
		List<WebElement> tableauElement = webDriver.findElements(By.tagName("th"));
		assertEquals(tableauElement.get(0).getText(),"ID Consultation :");
		assertEquals(tableauElement.get(1).getText(),"ID Consultant :");
		assertEquals(tableauElement.get(2).getText(),"ID Team :");
		assertEquals(tableauElement.get(3).getText(),"Date :");
		assertEquals(tableauElement.get(4).getText(),"Prix :");
		assertEquals(tableauElement.get(5).getText(),"Rapport :");
		assertEquals(firstString.getText(),"Consulting Report Management");
		
	}
}