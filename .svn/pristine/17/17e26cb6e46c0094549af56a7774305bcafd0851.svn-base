package fr.eseo.ld.proseboard.selenium;

import static org.testng.AssertJUnit.assertEquals;

import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.htmlunit.HtmlUnitDriver;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;

public class ProseBoardTestClient {
	private WebDriver webDriver;

	/*
	 * Initialise html driver + connexion en tant qu'auditeur.
	 */
	@BeforeClass
	public void initiateWebDriver() {
		webDriver = new HtmlUnitDriver();
		webDriver.get("http://localhost:8080/proseboard/login");
		WebElement mailBox = webDriver.findElement(By.name("login"));
		WebElement passwordBox = webDriver.findElement(By.name("password"));
		mailBox.sendKeys("client@proseboard.fr");
		passwordBox.sendKeys("admin");
		WebElement loginButton = webDriver.findElement(By.name("submit"));
		loginButton.click();
	}

	@Test
	public void testTitle() {
		assertEquals(webDriver.getTitle(), "ProSEBoard");
	}

	@Test(dependsOnMethods = { "testTitle" })
	public void testContenuClient() {
		List<WebElement> links = webDriver.findElements(By.tagName("li"));
		assertEquals(links.get(4).getText(), "Rémunérer une équipe");
	}

	@Test(dependsOnMethods = { "testContenuClient" })
	public void testRemunererEquipeLink() {
		WebElement link = webDriver.findElement(By
				.linkText("Rémunérer une équipe"));
		link.click();
		assertEquals(webDriver.getCurrentUrl(),
				"http://localhost:8080/proseboard/payTeam");
	}

	@Test(dependsOnMethods = { "testRemunererEquipeLink" })
	public void testContenuPage() {
		WebElement firstString = webDriver.findElement(By.tagName("h1"));
		List<WebElement> tableauElement = webDriver.findElements(By
				.tagName("th"));
		List<WebElement> buttons = webDriver.findElements(By.tagName("button"));
		assertEquals(firstString.getText(), "Equipes à rémunérer");
		assertEquals(tableauElement.get(0).getText(), "N° d'équipe");
		assertEquals(tableauElement.get(1).getText(), "Chef d'équipe");
		assertEquals(tableauElement.get(2).getText(), "Contrat");
		assertEquals(tableauElement.get(3).getText(), "Montant");
		assertEquals(buttons.get(0).getText(), "Contrat");
		assertEquals(buttons.get(1).getText(), "Rémunérer");
		assertEquals(buttons.get(2).getText(), "Annuler");
	}
}
