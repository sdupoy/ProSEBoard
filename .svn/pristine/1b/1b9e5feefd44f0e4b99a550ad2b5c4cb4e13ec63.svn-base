package fr.eseo.ld.proseboard.selenium;

import static org.testng.AssertJUnit.assertEquals;

import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.htmlunit.HtmlUnitDriver;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;

public class ProseBoardTestAuditeur {
	private WebDriver webDriver;

	/*
	 * Initialise html driver + connexion en tant qu'auditeur.
	 */
	@BeforeClass
	public void initiateWebDriver() {
		webDriver = new HtmlUnitDriver();
		webDriver.get("http://localhost:8080/proseboard/login");
		WebElement mailBox = webDriver.findElement(By.name("login"));
		WebElement passwordBox = webDriver.findElement(By.name("password"));
		mailBox.sendKeys("audit@prosebord.fr");
		passwordBox.sendKeys("admin");
		WebElement loginButton = webDriver.findElement(By.name("submit"));
		loginButton.click();
	}

	/*
	 * We test if we were on the right page
	 */
	@Test
	public void testTitlePage() {
		assertEquals(webDriver.getTitle(), "ProSEBoard");
	}

	/*
	 * Test if button for auditor's actions exists (actually just "Auditer")
	 */
	@Test(dependsOnMethods = { "testTitlePage" })
	public void testButtonsExist() {
		List<WebElement> webElements = webDriver.findElements(By.tagName("li"));
		assertEquals(webElements.get(4).getText(), "Auditer");
		assertEquals(webElements.get(5).getText(), "Voir compte");
		assertEquals(webElements.get(6).getText(), "Voir tous les audits");
		assertEquals(webElements.get(7).getText(), "Voir tous mes audits");
		assertEquals(webElements.get(8).getText(), "Voir audits précédents");
	}

	/*
	 * Test if content change when we click on Auditer.
	 */
	@Test(dependsOnMethods = { "testButtonsExist" })
	public void testLinkCorrect() {
		WebElement auditLink = webDriver.findElement(By.linkText("Auditer"));
		auditLink.click();
		assertEquals(webDriver.getCurrentUrl(),
				"http://localhost:8080/proseboard/audit/creer");
	}

	/*
	 * Test that elements for creating audit report exists. there are 14 inputs
	 * fields & 2 textearea fields & submit button
	 */

	@Test(dependsOnMethods = { "testLinkCorrect" })
	public void testElementsExist() {
		WebElement submitButton = webDriver.findElement(By.tagName("button"));
		WebElement titleString = webDriver.findElement(By.tagName("h1"));
		List<WebElement> webElementTextArea = webDriver.findElements(By
				.tagName("textarea"));
		List<WebElement> webElementsInput = webDriver.findElements(By
				.tagName("input"));
		assertEquals(submitButton.getText(), "Créer");
		assertEquals(webElementsInput.size(), 14);
		assertEquals(titleString.getText(), "Rapport d'Audit");
		assertEquals(webElementTextArea.size(), 2);
	}

	/*
	 * Test if we can create an audit report
	 */
	@Test(dependsOnMethods = { "testElementsExist" })
	public void testCreateAudit() {
		List<WebElement> webElementInput = webDriver.findElements(By
				.tagName("input"));
		List<WebElement> webElementText = webDriver.findElements(By
				.tagName("textarea"));
		WebElement submitButton = webDriver.findElement(By.tagName("button"));
		webElementInput.get(0).sendKeys("1");
		webElementInput.get(1).click();
		webElementInput.get(4).click();
		webElementInput.get(10).click();
		webElementInput.get(13).sendKeys("18");
		webElementText.get(0).sendKeys("Commentaire test selenium");
		webElementText.get(1).sendKeys("commentaire caché test selenium");
		submitButton.click();
		WebElement alertElement = webDriver.findElement(By.className("alert"));
		assertEquals(alertElement.getText(), "Audit enregistré avec succès");
		assertEquals(webDriver.getCurrentUrl(),
				"http://localhost:8080/proseboard/");

	}
}