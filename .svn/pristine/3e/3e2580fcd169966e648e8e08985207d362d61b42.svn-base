<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fr.eseo.ld.proseboard.mybatis.mappers.BillMapper">

	<resultMap type="Bill" id="BillResult">
		<id property="idBill" column="id_bill" />
		<result property="idTeamLeader" column="id_user_transmitter" />
		<result property="idClient" column="id_user_receiver" />
		<result property="subject" column="subject" />
		<result property="amount" column="amount" />
		<result property="comments" column="comments" />
		<result property="date" column="date" />
		<association property="team" javaType="Team">
			<id property="id" column="id_team" />
			<result property="idTeamLeader" column="id_team_leader" />
			<result property="teamName" column="team_name" />
			<result property="projectName" column="project_name" />
		</association>
		<association property="teamLeader" javaType="User">
			<id property="id" column="id_user" />
			<result property="firstName" column="first_name" />
			<result property="lastName" column="name" />
		</association>	
	</resultMap>
	
	<select id="getBillsForUserId" resultMap="BillResult" parameterType="long">
		SELECT bill.*, user.name, user.first_name, team.id_team_leader, team.project_name, team.team_name
		FROM bill, user, team
		WHERE id_user_receiver = #{userId}
		AND bill.id_user_transmitter = user.id_user
		AND team.id_team_leader = bill.id_user_transmitter
	</select>
	
	<select id="getAllBills" resultMap="BillResult" parameterType="long">
		SELECT * FROM bill 
	</select>
	
	<insert id="insert" parameterType="Bill" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO bill(id_user_transmitter, id_user_receiver, subject, amount, comments, date)
		VALUES(#{idUserTransmitter}, #{idUserReceiver}, #{subject}, #{amount}, #{comments}, #{date})
	</insert>
	
	<delete id="delete" parameterType="long">
		DELETE FROM bill WHERE id_bill = #{billId}
	</delete>
	
	<select id="getBillById" resultMap="BillResult" parameterType="long">
		SELECT * FROM bill WHERE id_bill = #{billId}
	</select>
	
</mapper>