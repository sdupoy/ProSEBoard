<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fr.eseo.ld.proseboard.mybatis.mappers.MessageMapper">

	<!-- Le type User est dÃ©fini dans fr.eseo.ld.proseboard.mybatis:config.xml -->
	<resultMap type="Message" id="MessageResult">
		<id property="idMessage" column="id_message" />
		<result property="idEmetter" column="id_emetter" />
		<result property="idReceiver" column="id_receiver" />
		<result property="mailEmetter" column="mail_emetter" />
		<result property="mailReceiver" column="mail_receiver" />
		<result property="date" column="date" />
		<result property="contain" column="contain" />
		<result property="read" column="read" />
		<result property="trashEmetter" column="trash_emetter" />
		<result property="trashReceiver" column="trash_receiver" />
		
	</resultMap>
	
	<insert id="insert" parameterType="Message" useGeneratedKeys="true" keyProperty="id_message">
		INSERT INTO message(id_emetter, id_receiver, mail_emetter, mail_receiver, date, contain)
		VALUES(#{idEmetter}, #{idReceiver}, #{mailEmetter}, #{mailReceiver}, #{date}, #{contain})
	</insert>
	
	<select id="getAll" resultMap="MessageResult" parameterType="_int">
		SELECT * FROM message
		WHERE id_receiver = #{id}
		ORDER BY date DESC
	</select>
	
	<select id="getAllEmetter" resultMap="MessageResult" parameterType="_int">
		SELECT * FROM message
		WHERE id_emetter = #{id}
		ORDER BY date DESC
	</select>
	
	<update id="supprimerReception" parameterType="_int">
		UPDATE message
		SET
		trash_receiver = 1
		WHERE id_message = #{id}
	</update>
	
	<update id="supprimerEnvoi" parameterType="_int">
		UPDATE message
		SET
		trash_emetter = 1
		WHERE id_message = #{id}
	</update>
	
	<delete id="supprimerBDD">
		DELETE 
		FROM message
		WHERE trash_receiver = 1
		AND trash_emetter = 1
	</delete>
	
	<update id="readMessage" parameterType="_int">
		UPDATE message
		SET
		message.read = 1
		WHERE id_receiver = #{id}
	</update>
	
	
	<select id="count" resultType="_int" parameterType="_int">
		SELECT COUNT(id_message) 
		FROM message
		WHERE id_receiver = #{id}
		AND message.read = 0
	</select>
	
</mapper>
	