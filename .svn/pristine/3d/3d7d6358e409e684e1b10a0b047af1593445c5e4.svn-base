package fr.eseo.ld.proseboard.selenium;

import static org.testng.AssertJUnit.assertEquals;

import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.htmlunit.HtmlUnitDriver;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;

public class ProseBoardTestLogInPage {

	private WebDriver webDriver;

	@BeforeClass
	public void initiateWebDriver() {
		webDriver = new HtmlUnitDriver();
	}

	/*
	 * Test check title for the basic url of our webApplication
	 */
	@Test
	public void testOpenHomePage() {
		webDriver.get("http://localhost:8080/proseboard");
		assertEquals(webDriver.getTitle(), "Connexion");
	}

	/*
	 * This test check that 2 inputs fields were in the page
	 */
	@Test(dependsOnMethods = { "testOpenHomePage" })
	public void testCheckLogInPage() {
		List<WebElement> webElements = webDriver.findElements(By
				.tagName("input"));
		assertEquals(webElements.size(), 2);
	}

	/*
	 * Test that input field login exist
	 */

	@Test(dependsOnMethods = { "testCheckLogInPage" })
	public void testCheckPwdPage() {
		WebElement webElement = webDriver.findElement(By.name("login"));
		assertEquals(
				webElement.toString(),
				"<input type=\"text\" name=\"login\" class=\"form-control input-lg\" placeholder=\"Identifiant\" required=\"\" autofocus=\"\" />");
	}

	/*
	 * Test that input field password exist
	 */
	@Test(dependsOnMethods = { "testCheckLogInPage" })
	public void testCheckLogIn() {
		WebElement webElement = webDriver.findElement(By.name("password"));
		assertEquals(
				webElement.toString(),
				"<input type=\"password\" name=\"password\" class=\"form-control input-lg\" placeholder=\"Mot de passe\" required=\"\" />");
	}

	/*
	 * Test submit button exist
	 */
	@Test(dependsOnMethods = { "testCheckLogIn" })
	public void testSubmitButton() {
		WebElement webElement = webDriver.findElement(By.name("submit"));
		assertEquals(
				webElement.toString(),
				"<button class=\"btn btn-lg btn-primary btn-block\" name=\"submit\" type=\"submit\">");
	}

	/*
	 * Test connexion with admin id We check if the title of the next page is
	 * true because if title change : connexion successful
	 */
	@Test(dependsOnMethods = { "testSubmitButton" })
	public void testLogIn() {

		WebElement usernameBox = webDriver.findElement(By.name("login"));
		WebElement passwordBox = webDriver.findElement(By.name("password"));
		usernameBox.sendKeys("admin@proseboard.fr");
		passwordBox.sendKeys("admin");
		WebElement loginButton = webDriver.findElement(By.name("submit"));
		loginButton.click();
		assertEquals(webDriver.getTitle(), "ProSEBoard");
	}

}
