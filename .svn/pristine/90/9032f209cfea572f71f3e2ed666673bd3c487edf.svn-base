<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fr.eseo.ld.proseboard.mybatis.mappers.StatusMapper">

	<!-- Le type User est dÃ©fini dans fr.eseo.ld.proseboard.mybatis:config.xml -->
	
	<resultMap type="Status" id="StatusResult">
		<id property="id" column="id_status" />
		<result property="name" column="status_name" />
	</resultMap>
	
	<select id="getById" parameterType="long" resultMap="StatusResult">
		SELECT * FROM status WHERE id_status = #{id}
	</select>

	<select id="getAll" resultMap="StatusResult">
		SELECT * FROM status
	</select>
	
	<select id="getAllForCreate" resultMap="StatusResult">
		SELECT * FROM status WHERE id_status not in (5,6) ORDER BY status_name
	</select>
	
	
	<insert id="bindUserToStatuses" parameterType="map">
		INSERT INTO status_user(id_user, id_status, id_session)
    	VALUES
   		<foreach collection="statuses" item="item" index="index" open="(" close=")" separator="),(">
    		#{user.id},#{item.id},#{item.idSession}
    	</foreach>
	</insert>
	
	<delete id="deleteStatusBySessionId" parameterType="long">
		DELETE c FROM consulting c
		LEFT JOIN team t
		ON t.id_team = c.id_team
		WHERE t.id_session = #{idSession}
	</delete>

</mapper>
