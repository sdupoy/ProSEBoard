<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fr.eseo.ld.proseboard.mybatis.mappers.TeamUserMapper">

	<!-- Le type User est dÃ©fini dans fr.eseo.ld.proseboard.mybatis:config.xml -->
	<resultMap type="TeamUser" id="MessageResult">
		<id property="idUser" column="id_user" />
		<id property="idTeam" column="id_team" />	
	</resultMap>

	<resultMap type="TeamUser" id="TeamUserResult">
		<id property="idUser" column="id_user" />
		<id property="idTeam" column="id_team" />	
	</resultMap>

	<select id="idTeamPrevious" resultType="Long" parameterType="Long">
		SELECT MIN(id_team)
		FROM team_user
		WHERE id_user = #{id}
	</select>
	
	<select id="idTeamCurrent" resultType="Long" parameterType="Long">
		SELECT MAX(id_team)
		FROM team_user
		WHERE id_user = #{id}
	</select>

	<insert id="insertTeamUser" parameterType="TeamUser" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO team_user(id_team, id_user)
		VALUES(#{idTeam}, #{idUser})
	</insert>
	
	<select id="getTeamUserByUserId" resultMap="TeamUserResult" parameterType="long">
		SELECT * FROM team_user WHERE id_user = #{idUser}
	</select>

	<delete id="deleteTeamUser" parameterType="long">
		DELETE FROM team_user WHERE id_user = #{idUser}
	</delete>

	<select id="getTeamIdFromUserId" resultType="long" parameterType="long">
		SELECT * FROM team_user WHERE id_user = #{idUser}
	</select>
		
	<select id="getAll" resultMap="TeamUserResult">
		SELECT * FROM team_user
	</select>
	
	<select id="getTeamUserByIdTeam" resultMap="TeamUserResult" parameterType="long">
		SELECT *  
		FROM team_user 
		WHERE id_team = #{idTeam}
	</select>
	
	
	
	<delete id="deleteTeamUserByTeamId" parameterType="long">
		DELETE FROM team_user WHERE id_team = #{idTeam}
	</delete>
	
	<delete id="deleteTeamUserBySessionId" parameterType="long">
		DELETE tu FROM team_user tu 
		LEFT JOIN team t
		ON tu.id_team = t.id_team
		WHERE t.id_session = #{idSession}
	</delete>

</mapper>